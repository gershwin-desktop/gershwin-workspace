." dsutil - .DS_Store file manipulation and utility tool
." Copyright (c) 2025-26 Simon Peter
." SPDX-License-Identifier: BSD-2-Clause
.TH DSUTIL 1 "January 2026" "Gershwin" "User Commands"
.SH NAME
dsutil \- manipulate .DS_Store files for .DS_Store interoperability
.SH SYNOPSIS
.B dsutil
.RI [ -v | --verbose ]
.I command
.RI [ options ]
.RI [ arguments ]
.br
.B dsutil
.RI [ -v | --verbose ]
.I directory
.SH DESCRIPTION
.B dsutil
is a command-line utility for reading and writing .DS_Store files.
It provides .DS_Store interoperability by allowing manipulation of icon positions,
view settings, backgrounds, file labels, and other metadata stored in .DS_Store files.
.PP
When invoked with just a directory path,
.B dsutil
displays a comprehensive summary of the directory's .DS_Store contents
with automatic coordinate conversions between .DS_Store format (top-left origin)
and GNUstep format (bottom-left origin).
.SH GLOBAL FLAGS
.TP
.B -v, --verbose
Show debug output with internal structure information including B-tree nodes,
block offsets, and entry parsing details. Useful for troubleshooting.
.SH FILE COMMANDS
.TP
.BI "create " path
Create an empty .DS_Store file at the specified path.
.TP
.BI "list " [path]
List all entries in a .DS_Store file. Defaults to .DS_Store in current directory.
.TP
.BI "dump " [path]
Dump complete file contents with detailed information about each entry.
.TP
.BI "info " path
Show file information and statistics.
.TP
.BI "validate " path
Validate .DS_Store file structure.
.TP
.BI "files " path
List all files that have metadata entries.
.TP
.BI "summary " directory
Show comprehensive summary of a directory's .DS_Store with coordinate conversions.
.SH ICON POSITION COMMANDS
.TP
.BI "get-pos " "file filename"
Get icon position coordinates for a file.
Shows both .DS_Store coordinates (top-left origin) and GNUstep equivalent.
.TP
.BI "set-pos " "file filename x y"
Set icon position in .DS_Store coordinates (pixels from top-left).
.SH BACKGROUND COMMANDS
.TP
.BI "get-bg " file
Get background settings for a directory. Shows background type (default, color, or image) and details.
For image backgrounds, displays the resolved image path.
.TP
.BI "set-bg-color " "file r g b"
Set solid color background. Colors are specified as floating-point values 0.0-1.0.
Stores background in modern binary plist format (icvp) for best interoperability.
.TP
.BI "set-bg-image " "file path"
Set background image. The path should be an absolute path to an image file (PNG, JPEG, etc.).
For maximum interoperability, the image is referenced using a simplified path storage format.
Modern .DS_Store files store this in the icvp plist's backgroundImageAlias field.
.TP
.BI "remove-bg " file
Remove background settings from the directory metadata.
.SH VIEW COMMANDS
.TP
.BI "get-view " file
Get view style and settings.
.TP
.BI "set-view " "file style"
Set view style. Valid styles: icon, list, column, gallery, flow.
.TP
.BI "set-iconsize " "file size"
Set icon size in pixels (16-512).
.TP
.BI "set-gridspacing " "file pixels"
Set icon grid spacing.
.TP
.BI "set-textsize " "file size"
Set label text size.
.TP
.BI "set-labelpos " "file position"
Set label position. Valid positions: bottom, right.
.TP
.BI "set-arrangement " "file arrangement"
Set icon arrangement. Valid values: none, grid.
.TP
.BI "set-sortby " "file key"
Set sort by key. Valid keys: name, date, size, kind, label, none.
.TP
.BI "set-showinfo " "file 0|1"
Enable/disable showing item info.
.TP
.BI "set-preview " "file 0|1"
Enable/disable showing icon previews.
.SH WINDOW CHROME COMMANDS
.TP
.BI "set-sidebar-width " "file pixels"
Set sidebar width in pixels.
.TP
.BI "set-toolbar " "file 0|1"
Show/hide toolbar.
.TP
.BI "set-sidebar " "file 0|1"
Show/hide sidebar.
.TP
.BI "set-pathbar " "file 0|1"
Show/hide path bar.
.TP
.BI "set-statusbar " "file 0|1"
Show/hide status bar.
.SH LABEL COLOR COMMANDS
.TP
.BI "get-label " "file filename"
Get file label color.
.TP
.BI "set-label " "file filename color"
Set file label color. Valid colors: none, red, orange, yellow, green, blue, purple, grey.
.SH COLUMN VIEW COMMANDS
.PP
.I NOTE:
Column view commands are only supported for directories with spatial/icon view mode enabled
(view style = icon). These commands will fail if the directory is configured for list, column,
or other non-spatial view modes. This limitation ensures proper coordination with native
.DS_Store column view implementations.
.TP
.BI "get-column-width " "file column"
Get column width in pixels. Columns: name, date, size, kind, label, version, comments.
.TP
.BI "set-column-width " "file column pixels"
Set column width in pixels.
.TP
.BI "get-column-visible " "file column"
Get column visibility status. Returns "visible" or "hidden".
.TP
.BI "set-column-visible " "file column 0|1"
Show or hide a column (1 = visible, 0 = hidden).
.TP
.BI "get-relative-dates " "file"
Get relative dates setting for column view (e.g., "today" instead of "1/5/26").
.TP
.BI "set-relative-dates " "file 0|1"
Enable/disable relative date display in columns (1 = enabled, 0 = disabled).
.SH METADATA COMMANDS
.TP
.BI "get-comment " "file filename"
Get file comment.
.TP
.BI "set-comment " "file filename text"
Set file comment.
.SH GENERIC FIELD COMMANDS
.TP
.BI "get " "file filename code"
Get field value by four-character code.
.TP
.BI "set " "file filename code type value"
Set field value. Type must be one of: bool, long, shor, ustr, type, blob, comp, dutc.
.TP
.BI "remove " "file filename code"
Remove field.
.TP
.BI "fields " "file filename"
List all fields for a filename.
.SH .DS_STORE FORMAT AND INTEROPERABILITY
The .DS_Store format has evolved over time, with modern files using binary plist formats
that provide richer metadata and better extensibility. This tool supports both legacy and
modern formats for maximum interoperability.
.PP
.B Format Preferences (Reading):
.RS
The tool automatically detects and reads from both modern and legacy formats:
.TP
.B Icon View Settings
Prefers
.I icvp
(binary plist) over legacy
.I icvo
(18-26 byte binary). The icvp format includes comprehensive settings including background images
stored in the backgroundImageAlias key.
.TP
.B Window Settings
Prefers
.I bwsp
(binary plist) over legacy
.I fwi0
(16 byte binary). The bwsp format includes WindowBounds, sidebar width, and toolbar visibility.
.TP
.B List View Settings
Prefers
.I lsvp
or
.I lsvP
(binary plist) over legacy
.I lsvo
(76 byte binary).
.TP
.B Background Images
Modern files store background images in the icvp plist's backgroundImageAlias field.
Legacy files use separate BKGD and pict entries. Both formats are supported.
.RE
.PP
.B Format Preferences (Writing):
.RS
For maximum interoperability, this tool writes using modern binary plist formats.
When setting backgrounds, view options, or window settings, the tool creates or updates
the appropriate plist entries (icvp, bwsp, lsvp) rather than legacy binary formats.
.RE
.SH FIELD CODES
Common four-character field codes used in .DS_Store files:
.TP
.B Iloc
Icon location (16 bytes: x, y coordinates as 4-byte big-endian signed integers for icon center,
plus 8 padding bytes). Coordinates are relative to top-left of window content area.
.TP
.B fwi0
Window geometry (16 bytes: top/left/bottom/right edges as 2-byte unsigned integers,
followed by 4-byte view style code, then 4 bytes flags/unknown).
.TP
.B vstl
View style (4-byte type code: icnv=icon, clmv=column, Nlsv=list, Flwv=coverflow, glyv=gallery).
.TP
.B icvo
Icon view options (18-26 bytes, two format variants).
.I icvo
format: 4-byte magic + 8 flags + 2-byte size + 4-byte arrangement.
.I icv4
format: 4-byte magic + 2-byte size + 4-byte arrangement + 4-byte label position + 12 flags.
.TP
.B icvp
Icon view properties (binary plist with keys: iconSize, gridSpacing, arrangeBy, labelOnBottom,
showIconPreview, showItemInfo, backgroundColorRed/Green/Blue, scrollPositionX/Y).
.TP
.B lsvp / lsvP
List view properties (binary plist with keys: textSize, iconSize, sortColumn, columns,
showIconPreview, useRelativeDates, calculateAllSizes, scrollPositionX/Y).
.TP
.B bwsp
Browser window settings (binary plist with keys: WindowBounds, SidebarWidth, ShowSidebar,
ShowToolbar, ShowStatusBar, ShowPathbar, ViewStyle, TargetURL, TargetPath).
.TP
.B BKGD
Background settings (12 bytes: 4-byte type code DefB/ClrB/PctB followed by type-specific data).
ClrB: 6 bytes RGB as 2-byte big-endian unsigned integers per channel.
.TP
.B cmmt
File comments (UTF-16 big-endian string, also stored in extended attributes on some systems).
.TP
.B icgo
Icon grid options (8 bytes: two 4-byte big-endian integers, purpose partially understood).
.TP
.B icsp
Icon spacing (8 bytes: spacing value typically in last 2 bytes as big-endian unsigned integer).
.TP
.B fwsw
Sidebar width (4-byte big-endian signed integer, pixels; zero if collapsed).
.TP
.B dilc
Desktop icon location (32 bytes: percentage-based coordinates for desktop icons, values in thousandths).
.TP
.B lsvo
List view options legacy format (76 bytes: column configuration, widths, sort order).
.TP
.B pict
Background picture (variable-length blob containing Alias record pointing to background image file).
.TP
.B GRP0
Sort/group settings (UTF-16 string, rarely seen, purpose unknown).
.SH COORDINATE SYSTEMS
.B dsutil
handles coordinate conversion between two systems:
.PP
.B .DS_Store format:
.RS
Origin at top-left corner of window content area.
X increases rightward, Y increases downward.
Icon positions represent the center of the icon, not its top-left corner.
.RE
.PP
.B GNUstep format:
.RS
Origin at bottom-left corner of view.
X increases rightward, Y increases upward.
.RE
.PP
When displaying icon positions, both coordinate systems are shown
to facilitate .DS_Store interoperability.
.SH DATA FORMAT NOTES
.PP
.B Multi-byte Integers:
All multi-byte integer values in .DS_Store files use big-endian byte order.
.PP
.B Icon Locations (Iloc):
Coordinates are stored as signed 32-bit integers representing the pixel position
of the icon's center (not its top-left corner) from the window's top-left origin.
The last 8 bytes are padding (typically 6 bytes of 0xFF followed by 2 bytes of 0x00).
.PP
.B Window Geometry (fwi0):
Window rect is stored as four 2-byte unsigned integers for top, left, bottom, and right edges.
This is followed by a 4-character view style code and 4 bytes of flags or unknown data.
.PP
.B Color Values:
RGB color components in BKGD fields are stored as 16-bit unsigned integers (0-65535),
not 8-bit values (0-255). Divide by 65535.0 to get normalized 0.0-1.0 floating-point values.
.PP
.B Property Lists:
Fields ending with 'p' (icvp, lsvp, bwsp) contain binary property lists that can be
parsed with standard plist libraries. These supersede older fixed-format fields
like icvo and lsvo on newer systems.
.PP
.B Format Variants:
Some fields have multiple format variants. For example, icvo has both "icvo" and "icv4"
format variants with different structures. The first 4 bytes identify the format magic.
.SH EXAMPLES
Create a new .DS_Store file:
.RS
.nf
dsutil create /path/to/.DS_Store
.fi
.RE
.PP
Set icon position:
.RS
.nf
dsutil set-pos .DS_Store image.jpg 100 200
.fi
.RE
.PP
Set background color (light blue):
.RS
.nf
dsutil set-bg-color .DS_Store 0.9 0.9 1.0
.fi
.RE
.PP
Set view to icon mode:
.RS
.nf
dsutil set-view .DS_Store icon
.fi
.RE
.PP
Set file label to red:
.RS
.nf
dsutil set-label .DS_Store important.txt red
.fi
.RE
.PP
Sort icons by name:
.RS
.nf
dsutil set-sortby .DS_Store name
.fi
.RE
.PP
Configure column view (spatial mode only):
.RS
.nf
# Set column widths
dsutil set-column-width .DS_Store name 200
dsutil set-column-width .DS_Store date 100
.PP
# Hide the version column, show the size column
dsutil set-column-visible .DS_Store version 0
dsutil set-column-visible .DS_Store size 1
.PP
# Enable relative date display in columns
dsutil set-relative-dates .DS_Store 1
.fi
.RE
.PP
Show summary of a directory:
.RS
.nf
dsutil /path/to/directory
.fi
.RE
.PP
Show summary with verbose debug output:
.RS
.nf
dsutil -v /path/to/directory
dsutil --verbose /path/to/directory
.fi
.RE
.SH FILES
.TP
.I .DS_Store
Per-directory metadata file storing icon positions, view settings, and file metadata.
.SH SEE ALSO
.BR gworkspace (1)
.SH HISTORY
.B dsutil
was written by Simon Peter for the Gershwin project to provide .DS_Store interoperability
with other operating systems that use .DS_Store files.
This implementation is based on documentation provided by third-party sources and is intended
to enable cross-platform compatibility and interoperability with systems that create and use .DS_Store metadata files.
.SH AUTHOR
Simon Peter
.SH COPYRIGHT
Copyright (c) 2025-26 Simon Peter.
Licensed under BSD-2-Clause.
